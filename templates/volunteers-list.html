{% extends "base.html" %}

{% block title %}All Volunteers{% endblock %}

{% block content %}
<style>
.volunteers-table { width: 100%; overflow-x: auto; margin-top: 20px; }
.volunteers-table table { width: 100%; border-collapse: collapse; background: white; border-radius: 8px; overflow: hidden; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
.volunteers-table thead { background: linear-gradient(135deg, #1e40af 0%, #3b82f6 50%, #60a5fa 100%); }
.volunteers-table th { padding: 16px; text-align: left; color: white; font-weight: 600; }
.volunteers-table td { padding: 16px; border-bottom: 1px solid #e5e7eb; }
.volunteers-table tbody tr:hover { background: #f9fafb; }
.btn { display: inline-block; padding: 10px 20px; border-radius: 6px; text-decoration: none; font-weight: 500; transition: all 0.3s; }
.btn-primary { background: linear-gradient(135deg, #1e40af 0%, #3b82f6 100%); color: white; border: none; }
.btn-primary:hover { transform: translateY(-2px); box-shadow: 0 4px 12px rgba(30, 64, 175, 0.4); }
.btn-secondary { background: #64748b; color: white; }
.status-badge { padding: 6px 12px; border-radius: 20px; font-size: 14px; font-weight: 500; }
.status-active { background: #d1fae5; color: #065f46; }
.status-inactive { background: #fee2e2; color: #991b1b; }
</style>
<div class="volunteers-list-container">
    <div class="page-header">
        <div>
            <h1>All Volunteers</h1>
            <p class="subtitle">Complete list of volunteers with performance statistics</p>
        </div>
        <a href="{{ url_for('dashboard.add_volunteer') }}" class="btn btn-primary">
            âž• Add Volunteer
        </a>
    </div>

    <div class="filters">
        <form method="GET" class="filter-form">
            <div class="form-group">
                <label for="search">Search:</label>
                <input type="text" id="search" name="search" placeholder="Search by name..." value="{{ search_query or '' }}">
            </div>
            
            <div class="form-group">
                <label for="status-filter">Status:</label>
                <select id="status-filter" name="status">
                    <option value="active" {% if selected_status == 'active' %}selected{% endif %}>Active</option>
                    <option value="inactive" {% if selected_status == 'inactive' %}selected{% endif %}>Inactive</option>
                    <option value="">All</option>
                </select>
            </div>

            <button type="submit" class="btn btn-primary">Search</button>
            {% if search_query %}
            <a href="{{ url_for('dashboard.volunteers_list') }}" class="btn btn-secondary">Clear</a>
            {% endif %}
        </form>
    </div>

    {% if search_query %}
    <div class="search-results-info">
        <p>Found <strong>{{ volunteers|length }}</strong> volunteer(s) matching "{{ search_query }}"</p>
    </div>
    {% endif %}

    <div class="volunteers-table">
        {% if volunteers %}
        <table>
            <thead>
                <tr>
                    <th>Name</th>
                    <th>Status</th>
                    <th>Evaluations</th>
                    <th>Avg Rating</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
                {% for vol in volunteers %}
                <tr>
                    <td><strong>{{ vol.first_name }} {{ vol.last_name }}</strong></td>
                    <td><span class="status-badge status-{{ vol.status }}">{{ vol.status|title }}</span></td>
                    <td>{{ vol.evaluations.count() }}</td>
                    <td>
                        {% set evals = vol.evaluations.all() %}
                        {% if evals %}
                            {% set total = namespace(score=0) %}
                            {% for eval in evals %}
                                {% set avg = (eval.reliability + eval.quality_of_work + eval.initiative + eval.teamwork + eval.communication) / 5.0 %}
                                {% set total.score = total.score + avg %}
                            {% endfor %}
                            {% set overall_avg = total.score / evals|length %}
                            <span class="rating-badge rating-{{ "%.0f"|format(overall_avg) }}">
                                {{ "%.1f"|format(overall_avg) }}
                            </span>
                        {% else %}
                            <span style="color: #94a3b8;">No evaluations</span>
                        {% endif %}
                    </td>
                    <td>
                        <a href="{{ url_for('dashboard.volunteer_profile', volunteer_id=vol.id) }}" class="btn btn-small">View Profile</a>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
        {% else %}
        <p class="no-data">No volunteers found matching your criteria.</p>
        {% endif %}
    </div>

    <div class="list-actions">
        <a href="{{ url_for('dashboard.index') }}" class="btn btn-secondary">Back to Dashboard</a>
    </div>
</div>

<style>
.search-results-info {
    background: #f0f9ff;
    border-left: 4px solid #3b82f6;
    padding: 1rem;
    margin-bottom: 1rem;
    border-radius: 6px;
}

.search-results-info p {
    margin: 0;
    color: #1e40af;
}

.page-header {
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
    margin-bottom: 2rem;
}

.page-header h1 {
    margin-bottom: 0.5rem;
}

.page-header .subtitle {
    margin-bottom: 0;
}

.filters {
    background-color: var(--card-bg);
    padding: 1.5rem;
    border-radius: 0.5rem;
    box-shadow: var(--shadow);
    margin-bottom: 2rem;
}

.filter-form {
    display: flex;
    gap: 1rem;
    align-items: flex-end;
    flex-wrap: wrap;
}

.filter-group {
    flex: 1;
    min-width: 200px;
}

.filter-group label {
    display: block;
    font-weight: 600;
    margin-bottom: 0.5rem;
    color: var(--text-primary);
}

.filter-group select {
    width: 100%;
    padding: 0.75rem;
    border: 1px solid var(--border-color);
    border-radius: 0.375rem;
    font-size: 1rem;
}

.volunteers-table {
    background-color: var(--card-bg);
    padding: 2rem;
    border-radius: 0.5rem;
    box-shadow: var(--shadow);
    margin-bottom: 2rem;
}

.list-actions {
    text-align: center;
}
</style>
{% endblock %}
